
<!--
  Mintest Forum Recovery Project (by sorcerykid)

  https://sorcerykid.github.io/minetest-forums/pages/3_18263.htm

  The following page was cached by Bing Bot (https://bing.com/) on 23-Apr-2019.
  All archived content is subject to copyright. No warranty or guaranty is implied.
-->
<base href="https://forum.minetest.net/" />
<html xmlns="http://www.w3.org/1999/xhtml" dir="ltr" lang="en-gb" xml:lang="en-gb">
<head>

<meta http-equiv="content-type" content="text/html; charset=UTF-8" />
<meta http-equiv="content-style-type" content="text/css" />
<meta http-equiv="content-language" content="en-gb" />
<meta http-equiv="imagetoolbar" content="no" />
<meta name="resource-type" content="document" />
<meta name="distribution" content="global" />
<meta name="keywords" content="" />
<meta name="description" content="" />

<title>Minetest Forums &bull; View topic - Minetest with LuaJit GC64 mode (%TOPIC_TITLE%gt;2gb mem)</title>

<link rel="alternate" type="application/atom+xml" title="Feed - Minetest Forums" href="https://forum.minetest.net/feed.php" /><link rel="alternate" type="application/atom+xml" title="Feed - New Topics" href="https://forum.minetest.net/feed.php?mode=topics" /><link rel="alternate" type="application/atom+xml" title="Feed - Forum - Mods" href="https://forum.minetest.net/feed.php?f=46" /><link rel="alternate" type="application/atom+xml" title="Feed - Topic - Minetest with LuaJit GC64 mode (%TOPIC_TITLE%gt;2gb mem)" href="https://forum.minetest.net/feed.php?f=3&amp;t=18263" />

<!--
	phpBB style name: prosilver
	Based on style:   prosilver (this is the default phpBB3 style)
	Original author:  Tom Beddard ( http://www.subBlue.com/ )
	Modified by:
-->

<link href="./styles/prosilver/theme/print.css" rel="stylesheet" type="text/css" media="print" title="printonly" />
<link href="./style.php?id=5&amp;lang=en" rel="stylesheet" type="text/css" media="screen, projection" />

<link href="./styles/prosilver/theme/normal.css" rel="stylesheet" type="text/css" title="A" />
<link href="./styles/prosilver/theme/medium.css" rel="alternate stylesheet" type="text/css" title="A+" />
<link href="./styles/prosilver/theme/large.css" rel="alternate stylesheet" type="text/css" title="A++" />

</head>

<body id="phpbb" class="section-viewtopic ltr">

<div id="wrap">
	<a id="top" name="top" accesskey="t"></a>
	<div id="page-header">
		<div class="headerbar">
			<div class="inner"><span class="corners-top"><span></span></span>

			<div id="site-description">
				<a href="./index.php" title="Board index" id="logo"><img src="./styles/prosilver/imageset/site_logo.gif" width="149" height="52" alt="" title="" /></a>
				<h1>Minetest Forums</h1>
				<p>The official Minetest discussion board</p>
				<p class="skiplink"><a href="#start_here">Skip to content</a></p>
			</div>

			<span class="corners-bottom"><span></span></span></div>
		</div>

		<div class="navbar">
			<div class="inner"><span class="corners-top"><span></span></span>

			<ul class="linklist navlinks">
				<li class="icon-home"><a href="./index.php" accesskey="h">Board index</a> <strong>&#8249;</strong> <a href="./viewforum.php?f=3">General Discussion</a></li>
			</ul>

			<span class="corners-bottom"><span></span></span></div>
		</div>
	</div>

	<a name="start_here"></a>
	<div id="page-body">
		
<h2><a href="./viewtopic.php?f=46&amp;t=18263">Minetest with LuaJit GC64 mode (%TOPIC_TITLE%gt;2gb mem)</a></h2>
<!-- NOTE: remove the style="display: none" when you want to have the forum description on the topic body -->

<div class="topic-actions">
		<div class="pagination">
			5 posts
			 &bull; Page <strong>1</strong> of <strong>1</strong>
		</div>
</div>
<div class="clear"></div>

	<div id="p288049" class="post bg2">
		<div class="inner"><span class="corners-top"><span></span></span>

		<div class="postbody">
			<h3 class="first"><a href="https://sorcerykid.github.io/minetest-forums/pages/pages/3_18263.htm#p288049">Minetest with LuaJit GC64 mode (&gt;2gb mem)</a></h3>
			<p class="author"><img src="./styles/prosilver/imageset/icon_post_target.gif" width="11" height="9" alt="Post" title="Post" />by <strong>Fixer</strong> &raquo; Tue Aug 08, 2017 3:07 pm </p>

			<div class="content">LuaJIT 2.1.0-beta3 was recently released, changelog states:<br />&quot;Apart from various fixes, the major new features are JIT compiler <span style="font-weight: bold">support for x64 in GC64 mode</span>, ARM64 and MIPS64.&quot;<br /><br />In GC64 mode LuaJit can address more than 2Gb of memory, that in theory will prevent most of OOM errors you see in minetest with heavy modpacks, worldedit or other cases. Some people like me were heavily impacted by 2gb memory limit with impossibility to play heavy modpacks (at least on windows).<br /><br />People are welcome to test the <a href="https://kitsunemimi.pw/tmp/minetest-0.4.16-gc64-win64.7z" class="postlink">build</a> (by sfan5).<br /><br />My results so far:<br />+ Worldedit works on large volumes now, I had no problems editing areas as much as 800x800x100 (65 million nodes) with minetest mem usage up to 4.5 Gb, that was clearly not possible before.<br />+ Dreambuilder modpack straight fly test for over 1 hr 40 min without any OOMs (without gc64 it is just 5-10 min before OOM).<br />+ Testing lua code for consuming lots of memory seems to work without crash now: <dl class="codebox"><dt>Code: <a href="#" onclick="selectCode(this); return false;">Select all</a></dt><dd><code>a = {}; for i = 1,1500000 do a&#91;i&#93; = table.copy(minetest.registered_nodes); end</code></dd></dl><br />Original issue about Lua OOM problems: <!-- m --><a class="postlink" href="https://github.com/minetest/minetest/issues/2988">https://github.com/minetest/minetest/issues/2988</a><!-- m --><br /><span style="font-weight: bold">People with lua out of memory errors are welcome to test this, this may be a cure.</span></div>
		</div>

			<dl class="postprofile">
			<dt>
				<strong>Fixer</strong>
			</dt>
			<dd></dd>

		<dd>&nbsp;</dd>

		<dd><strong>Posts:</strong> 891</dd><dd><strong>Joined:</strong> Sun Jul 31, 2011 11:23 am</dd>
		<!--	<dd><strong>GitHub:</strong> %MEMBER_GITHUB_HANDLE%</dd>
			<dd><strong>IRC:</strong> %MEMBER_IRC_HANDLE%</dd> -->
		</dl>
	
		<div class="back2top"><a href="#wrap" class="top" title="Top">Top</a></div>

		<span class="corners-bottom"><span></span></span></div>
	</div>

	<hr class="divider" />
	<div id="p292048" class="post bg1">
		<div class="inner"><span class="corners-top"><span></span></span>

		<div class="postbody">
			<h3 class=""><a href="https://sorcerykid.github.io/minetest-forums/pages/pages/3_18263.htm#p292048">Re: Minetest with LuaJit GC64 mode (&gt;2gb mem)</a></h3>
			<p class="author"><img src="./styles/prosilver/imageset/icon_post_target.gif" width="11" height="9" alt="Post" title="Post" />by <strong>elettrico</strong> &raquo; Mon Sep 04, 2017 4:01 pm </p>

			<div class="content">In my linux mint machine how can I install the latest LuaJIT? Is there an official PPA? Or better remove the package and compile it from sources? Which version of lua is supported?</div>
		</div>

			<dl class="postprofile">
			<dt>
				<strong>elettrico</strong>
			</dt>
			<dd></dd>

		<dd>&nbsp;</dd>

		<dd><strong>Posts:</strong> 22</dd><dd><strong>Joined:</strong> Thu Jul 20, 2017 8:00 pm</dd>
		<!--	<dd><strong>GitHub:</strong> %MEMBER_GITHUB_HANDLE%</dd>
			<dd><strong>IRC:</strong> %MEMBER_IRC_HANDLE%</dd> -->
		</dl>
	
		<div class="back2top"><a href="#wrap" class="top" title="Top">Top</a></div>

		<span class="corners-bottom"><span></span></span></div>
	</div>

	<hr class="divider" />
	<div id="p292209" class="post bg2">
		<div class="inner"><span class="corners-top"><span></span></span>

		<div class="postbody">
			<h3 class="first"><a href="https://sorcerykid.github.io/minetest-forums/pages/pages/3_18263.htm#p292209">Re: Minetest with LuaJit GC64 mode (&gt;2gb mem)</a></h3>
			<p class="author"><img src="./styles/prosilver/imageset/icon_post_target.gif" width="11" height="9" alt="Post" title="Post" />by <strong>elettrico</strong> &raquo; Wed Sep 06, 2017 2:15 am </p>

			<div class="content">Today I've built LuaJIT 2.1.0-beta3 and built minetestserver using it.<br />When I've tried to do a //sphere 250 air with worldedit (in a emerged area) it crashed with OOM.<br />When I've tried to do the same but with a 200 blocks radius it crashed with this error:<br /><br />2017-09-05 23:04:08: ERROR[Main]: ServerError: AsyncErr: ServerThread::run Lua: Runtime error from mod 'worldedit_commands' in callback on_chat_message(): std::bad_alloc                                                       <br />2017-09-05 23:04:08: ERROR[Main]: stack traceback:<br />2017-09-05 23:04:08: ERROR[Main]:       [C]: in function 'write_to_map'<br />2017-09-05 23:04:08: ERROR[Main]:       ...r/.minetest/mods/Minetest-WorldEdit/worldedit/common.lua:111: in function 'finish'<br />2017-09-05 23:04:08: ERROR[Main]:       ...inetest/mods/Minetest-WorldEdit/worldedit/primitives.lua:41: in function 'sphere'<br />2017-09-05 23:04:08: ERROR[Main]:       ...test/mods/Minetest-WorldEdit/worldedit_commands/init.lua:492: in function 'callback'<br />2017-09-05 23:04:08: ERROR[Main]:       ...test/mods/Minetest-WorldEdit/worldedit_commands/safe.lua:48: in function 'func'<br />2017-09-05 23:04:08: ERROR[Main]:       ...est-install/share/minetest/builtin/game/chatcommands.lua:30: in function &lt;...est-install/share/minetest/builtin/game/chatcommands.lua:9&gt;<br />2017-09-05 23:04:08: ERROR[Main]:       ...inetest-install/share/minetest/builtin/game/register.lua:412: in function &lt;...inetest-install/share/minetest/builtin/game/register.lua:392&gt;<br /><br />leaving map barely untouched (instead of a large sphere there's a 64x64x64 hole)</div>
		</div>

			<dl class="postprofile">
			<dt>
				<strong>elettrico</strong>
			</dt>
			<dd></dd>

		<dd>&nbsp;</dd>

		<dd><strong>Posts:</strong> 22</dd><dd><strong>Joined:</strong> Thu Jul 20, 2017 8:00 pm</dd>
		<!--	<dd><strong>GitHub:</strong> %MEMBER_GITHUB_HANDLE%</dd>
			<dd><strong>IRC:</strong> %MEMBER_IRC_HANDLE%</dd> -->
		</dl>
	
		<div class="back2top"><a href="#wrap" class="top" title="Top">Top</a></div>

		<span class="corners-bottom"><span></span></span></div>
	</div>

	<hr class="divider" />
	<div id="p292256" class="post bg1">
		<div class="inner"><span class="corners-top"><span></span></span>

		<div class="postbody">
			<h3 class=""><a href="https://sorcerykid.github.io/minetest-forums/pages/pages/3_18263.htm#p292256">Re: Minetest with LuaJit GC64 mode (&gt;2gb mem)</a></h3>
			<p class="author"><img src="./styles/prosilver/imageset/icon_post_target.gif" width="11" height="9" alt="Post" title="Post" />by <strong>sfan5</strong> &raquo; Wed Sep 06, 2017 11:56 am </p>

			<div class="content">Just building 2.1.0-beta3 is not enough, you also need to uncomment <a href="https://github.com/LuaJIT/LuaJIT/blob/v2.1/src/Makefile#L114" class="postlink">this</a> in the Makefile.<br />So far I've had no luck getting that mode to run without segfaults under stress testing (on Linux).</div>
		</div>

			<dl class="postprofile">
			<dt>
				<strong>sfan5</strong>
			</dt>
			<dd></dd>

		<dd>&nbsp;</dd>

		<dd><strong>Posts:</strong> 3791</dd><dd><strong>Joined:</strong> Wed Aug 24, 2011 9:44 am</dd>
		<!--	<dd><strong>GitHub:</strong> %MEMBER_GITHUB_HANDLE%</dd>
			<dd><strong>IRC:</strong> %MEMBER_IRC_HANDLE%</dd> -->
		</dl>
	
		<div class="back2top"><a href="#wrap" class="top" title="Top">Top</a></div>

		<span class="corners-bottom"><span></span></span></div>
	</div>

	<hr class="divider" />
	<div id="p346659" class="post bg2">
		<div class="inner"><span class="corners-top"><span></span></span>

		<div class="postbody">
			<h3 class="first"><a href="https://sorcerykid.github.io/minetest-forums/pages/pages/3_18263.htm#p346659">Re: Minetest with LuaJit GC64 mode (&gt;2gb mem)</a></h3>
			<p class="author"><img src="./styles/prosilver/imageset/icon_post_target.gif" width="11" height="9" alt="Post" title="Post" />by <strong>Festus1965</strong> &raquo; Wed Mar 20, 2019 2:50 pm </p>

			<div class="content">Where to load it ... as also rubenwardy <a href="https://forum.minetest.net/viewtopic.php?f=47&amp;t=22374&amp;view=unread#p346655" class="postlink">suggested it</a><br /><br />this <dl class="codebox"><dt>Code: <a href="#" onclick="selectCode(this); return false;">Select all</a></dt><dd><code>#XCFLAGS+= -DLUAJIT_ENABLE_GC64</code></dd></dl> I searched in my config (linux/ubuntu - yes:2.1.0-beta3- ... compile) I didn't find in the make file off that folder luajit-210-beta3<br /><br />but I used it for compiling, and server is anyway running in LuaLit again, after moreblocks and etherreal off / false.</div>
		</div>

			<dl class="postprofile">
			<dt>
				<strong>Festus1965</strong>
			</dt>
			<dd></dd>

		<dd>&nbsp;</dd>

		<dd><strong>Posts:</strong> 956</dd><dd><strong>Joined:</strong> Sun Jan 03, 2016 11:58 am</dd>
		<!--	<dd><strong>GitHub:</strong> %MEMBER_GITHUB_HANDLE%</dd>
			<dd><strong>IRC:</strong> %MEMBER_IRC_HANDLE%</dd> -->
		</dl>
	
		<div class="back2top"><a href="#wrap" class="top" title="Top">Top</a></div>

		<span class="corners-bottom"><span></span></span></div>
	</div>

	<hr class="divider" />

	<hr class="divider" />

	<hr />

<div class="topic-actions">
		<div class="pagination">
			5 posts
			 &bull; Page <strong>1</strong> of <strong>1</strong>
		</div>
</div>

	<p></p><p><a href="./viewforum.php?f=3" class="left-box left" accesskey="r">Return to General Discussion</a></p>

	<br /><br />

	<h3>Who is online</h3>
	<p>Users browsing this forum: <span style="color: #9E8DA7;" class="username-coloured">Bing Bot [Bot]</span> and 0 guests</p>
</div>

<div id="page-footer">

	<div class="navbar">
		<div class="inner"><span class="corners-top"><span></span></span>

		<ul class="linklist">
			<li class="icon-home"><a href="./index.php">Board index</a></li>
				
			<li class="rightside">All times are UTC </li>
		</ul>

		<span class="corners-bottom"><span></span></span></div>
	</div>

	<div class="copyright">Powered by <a href="https://www.phpbb.com/">phpBB</a>&reg; Forum Software &copy; phpBB Group
		
	</div>
</div>

</div>

<div>
	<a id="bottom" name="bottom" accesskey="z"></a>
	
</div>

</body>
</html></div>
