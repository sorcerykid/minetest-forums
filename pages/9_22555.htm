
<!--
  Mintest Forum Recovery Project (by sorcerykid)

  https://sorcerykid.github.io/minetest-forums/pages/9_22555.htm

  The following page was cached by Yandex Bot (https://yandex.com/) on 25-Apr-2019.
  All archived content is subject to copyright. No warranty or guaranty is implied.
-->
<base href="https://forum.minetest.net/" />
<html xmlns="http://www.w3.org/1999/xhtml" dir="ltr" lang="en-gb" xml:lang="en-gb">
<head>

<meta http-equiv="content-type" content="text/html; charset=UTF-8" />
<meta http-equiv="content-style-type" content="text/css" />
<meta http-equiv="content-language" content="en-gb" />
<meta http-equiv="imagetoolbar" content="no" />
<meta name="resource-type" content="document" />
<meta name="distribution" content="global" />
<meta name="keywords" content="" />
<meta name="description" content="" />

<title>Minetest Forums &bull; View topic - [Mod]FFIopt [ffiopt]</title>

<link rel="alternate" type="application/atom+xml" title="Feed - Minetest Forums" href="https://forum.minetest.net/feed.php" /><link rel="alternate" type="application/atom+xml" title="Feed - New Topics" href="https://forum.minetest.net/feed.php?mode=topics" /><link rel="alternate" type="application/atom+xml" title="Feed - Forum - Mods" href="https://forum.minetest.net/feed.php?f=46" /><link rel="alternate" type="application/atom+xml" title="Feed - Topic - [Mod]FFIopt [ffiopt]" href="https://forum.minetest.net/feed.php?f=9&amp;t=22555" />

<!--
	phpBB style name: prosilver
	Based on style:   prosilver (this is the default phpBB3 style)
	Original author:  Tom Beddard ( http://www.subBlue.com/ )
	Modified by:
-->

<link href="./styles/prosilver/theme/print.css" rel="stylesheet" type="text/css" media="print" title="printonly" />
<link href="./style.php?id=5&amp;lang=en" rel="stylesheet" type="text/css" media="screen, projection" />

<link href="./styles/prosilver/theme/normal.css" rel="stylesheet" type="text/css" title="A" />
<link href="./styles/prosilver/theme/medium.css" rel="alternate stylesheet" type="text/css" title="A+" />
<link href="./styles/prosilver/theme/large.css" rel="alternate stylesheet" type="text/css" title="A++" />

</head>

<body id="phpbb" class="section-viewtopic ltr">

<div id="wrap">
	<a id="top" name="top" accesskey="t"></a>
	<div id="page-header">
		<div class="headerbar">
			<div class="inner"><span class="corners-top"><span></span></span>

			<div id="site-description">
				<a href="./index.php" title="Board index" id="logo"><img src="./styles/prosilver/imageset/site_logo.gif" width="149" height="52" alt="" title="" /></a>
				<h1>Minetest Forums</h1>
				<p>The official Minetest discussion board</p>
				<p class="skiplink"><a href="#start_here">Skip to content</a></p>
			</div>

			<span class="corners-bottom"><span></span></span></div>
		</div>

		<div class="navbar">
			<div class="inner"><span class="corners-top"><span></span></span>

			<ul class="linklist navlinks">
				<li class="icon-home"><a href="./index.php" accesskey="h">Board index</a> <strong>&#8249;</strong> <a href="./viewforum.php?f=9">WIP Mods</a></li>
			</ul>

			<span class="corners-bottom"><span></span></span></div>
		</div>
	</div>

	<a name="start_here"></a>
	<div id="page-body">
		
<h2><a href="./viewtopic.php?f=46&amp;t=22555">[Mod]FFIopt [ffiopt]</a></h2>
<!-- NOTE: remove the style="display: none" when you want to have the forum description on the topic body -->

<div class="topic-actions">
		<div class="pagination">
			13 posts
			 &bull; Page <strong>1</strong> of <strong>1</strong>
		</div>
</div>
<div class="clear"></div>

	<div id="p349060" class="post bg2">
		<div class="inner"><span class="corners-top"><span></span></span>

		<div class="postbody">
			<h3 class="first"><a href="https://sorcerykid.github.io/minetest-forums/pages/9_22555.htm#p349060">[Mod]FFIopt [ffiopt]</a></h3>
			<p class="author"><img src="./styles/prosilver/imageset/icon_post_target.gif" width="11" height="9" alt="Post" title="Post" />by <strong>EvidenceBKidscode</strong> &raquo; Wed Apr 17, 2019 14:41 </p>

			<div class="content">FFIopt optimizes access to large amounts of data via the Lua API and reduces Lua memory footprint. <br /><br /><span style="font-weight: bold">License</span>: LGPL v3<br /><br /><span style="font-weight: bold">Dependancies</span>: None of mods but needs engine to be patched<br /><br /><span style="font-weight: bold">Source</span>: <a href="https://github.com/EvidenceBKidscode/ffiopt" class="postlink">https://github.com/EvidenceBKidscode/ffiopt</a><br /><br /><span style="font-size: 150%; line-height: 116%;"><span style="font-weight: bold">Description</span></span><br /><br />Lua API methods that transmit large amount of data (<span style="font-style: italic">VoxelManip:get_data</span>, <span style="font-style: italic">PerlinNoiseMap:get3dMap_flat</span>) copies data from C++ structures to Lua tables. This copy is quite slow and consumes a lot of Lua memory.<br /><br /><span style="font-weight: bold">FFIopt</span> replaces this copy by a direct access from Lua to C++ data using FFI library. The engine has to be patched to expose some C++ pointers to Lua API.<br /><br />If engine correctly patched, FFIopt hacks VoxelManip and PerlinNoiseMap to use FFI rather than Lua tables.<br /><br />Result is :<br /><ul><li>Faster data retreiving and storing ;</li><li>Slower table access (essencially due to use of metatable avoiding mods code change) ;</li><li>Lower Lua memory footprint (avoiding many OOM errors) ;</li></ul><span style="font-size: 150%; line-height: 116%;"><span style="font-weight: bold">How to use it</span></span><br /><br /><ul><li>Use LuaJIT.</li><li>Patch the engine to add <span style="font-style: italic">VoxelManip:get_data_ptr</span>, <span style="font-style: italic">PerlinNoiseMap:get_result_size</span> and <span style="font-style: italic">PerlinNoiseMap:get_result_ptr</span> methods to the API.</li><li>Install and enable <span style="font-weight: bold">ffiopt</span> mod.</li><li>On starting Minetest, ffiopt will tell if it is able to optimise voxel manips and perlin noise.</li><li><span style="text-decoration: underline">Nothing to change in mods code</span>.</li></ul><br /><span style="font-size: 150%; line-height: 116%;"><span style="font-weight: bold">Experiments</span></span><br /><br /><span style="font-weight: bold">FFIopt</span> can be tested through <span style="font-weight: bold">ffiopt_demo</span> mod. Here is what we obtained.<br /><br /><span style="font-size: 120%; line-height: 116%;"><span style="font-weight: bold">Voxel Manip</span></span><br /><br />Without <span style="font-weight: bold">FFIopt</span>, in the demo, 30 % of the time is spend in <span style="font-style: italic">get_data</span> and another 30 % is spent in <span style="font-style: italic">set_data</span>. Lua processing takes 20 % and read/write the remaining 20 %.<br /><br />So most of the time is spent in converting C++ data to Lua table.<br /><br />With <span style="font-weight: bold">FFIopt</span>, Lua takes 68 % of the time and read/write 32 % (<span style="font-style: italic">get_data</span> and <span style="font-style: italic">set_data</span> don’t do anything).<br />Lua processing time is increased by 75 %, but <span style="text-decoration: underline">total time is reduced by 50 %</span>.<br /><br />Furthermore, without <span style="font-weight: bold">FFIopt</span>, launching demo 9 times leaded to 3 OOM crash. With <span style="font-weight: bold">FFIopt</span>, we have been able to launch more than 20 times the demo with no crash.<br /><br /><span style="font-size: 120%; line-height: 116%;"><span style="font-weight: bold">Perlin noise</span></span><br /><br />With <span style="font-weight: bold">FFIopt</span>, Lua processing increased by 50 % but total time reduced by 15 %.<br /><br />Lua time is increased mostly because of the use of a metatable. This can be avoided but the mod code has to be changed (C++ indexes starts from 0, not 1) and secured to avoid out of range indexes.</div>
		</div>

			<dl class="postprofile">
			<dt>
				<strong>EvidenceBKidscode</strong>
			</dt>
			<dd>New member</dd>

		<dd>&nbsp;</dd>

		<dd><strong>Posts:</strong> 5</dd><dd><strong>Joined:</strong> Tue Feb 05, 2019 13:33</dd>
			
			
		</dl>
	
		<div class="back2top"><a href="#wrap" class="top" title="Top">Top</a></div>

		<span class="corners-bottom"><span></span></span></div>
	</div>

	<hr class="divider" />
	<div id="p349068" class="post bg1">
		<div class="inner"><span class="corners-top"><span></span></span>

		<div class="postbody">
			<h3 class=""><a href="https://sorcerykid.github.io/minetest-forums/pages/9_22555.htm#p349068">Re: [Mod]FFIopt [ffiopt]</a></h3>
			<p class="author"><img src="./styles/prosilver/imageset/icon_post_target.gif" width="11" height="9" alt="Post" title="Post" />by <strong>runs</strong> &raquo; Wed Apr 17, 2019 16:07 </p>

			<div class="content">Why is not this in the official engine yet?<br /><br />Are you a <!-- m --><a class="postlink" href="https://kidscode.com">https://kidscode.com</a><!-- m --> developer?</div>
		</div>

			<dl class="postprofile">
			<dt>
				<strong>runs</strong>
			</dt>
			<dd>Member</dd>

		<dd>&nbsp;</dd>

		<dd><strong>Posts:</strong> 377</dd><dd><strong>Joined:</strong> Sat Oct 27, 2018 08:32</dd>
			<dd><strong>GitHub:</strong> runsy</dd>
			
		</dl>
	
		<div class="back2top"><a href="#wrap" class="top" title="Top">Top</a></div>

		<span class="corners-bottom"><span></span></span></div>
	</div>

	<hr class="divider" />
	<div id="p349120" class="post bg2">
		<div class="inner"><span class="corners-top"><span></span></span>

		<div class="postbody">
			<h3 class="first"><a href="https://sorcerykid.github.io/minetest-forums/pages/9_22555.htm#p349120">Re: [Mod]FFIopt [ffiopt]</a></h3>
			<p class="author"><img src="./styles/prosilver/imageset/icon_post_target.gif" width="11" height="9" alt="Post" title="Post" />by <strong>Pyrollo</strong> &raquo; Thu Apr 18, 2019 06:32 </p>

			<div class="content"><blockquote><div><cite>runs wrote:</cite>Are you a <!-- m --><a class="postlink" href="https://kidscode.com">https://kidscode.com</a><!-- m --> developer?</div></blockquote><br /><br />Obviously.<br /><br />Have a look here: <!-- l --><a class="postlink-local" href="https://forum.minetest.net/viewtopic.php?f=3&amp;t=22090">viewtopic.php?f=3&amp;t=22090</a><!-- l --></div>
		</div>

			<dl class="postprofile">
			<dt>
				<strong>Pyrollo</strong>
			</dt>
			<dd>Member</dd>

		<dd>&nbsp;</dd>

		<dd><strong>Posts:</strong> 261</dd><dd><strong>Joined:</strong> Mon Jan 08, 2018 15:14</dd>
			<dd><strong>GitHub:</strong> pyrollo</dd>
			<dd><strong>In-game:</strong> Naj</dd>
		</dl>
	
		<div class="back2top"><a href="#wrap" class="top" title="Top">Top</a></div>

		<span class="corners-bottom"><span></span></span></div>
	</div>

	<hr class="divider" />
	<div id="p349125" class="post bg1">
		<div class="inner"><span class="corners-top"><span></span></span>

		<div class="postbody">
			<h3 class=""><a href="https://sorcerykid.github.io/minetest-forums/pages/9_22555.htm#p349125">Re: [Mod]FFIopt [ffiopt]</a></h3>
			<p class="author"><img src="./styles/prosilver/imageset/icon_post_target.gif" width="11" height="9" alt="Post" title="Post" />by <strong>Festus1965</strong> &raquo; Thu Apr 18, 2019 09:37 </p>

			<div class="content">I am <a href="https://forum.minetest.net/viewtopic.php?f=10&amp;t=22041&amp;p=349124#p349124" class="postlink">using it actual</a>, got the patch done, mod active<br />thanks, I was reading that about the FFI, but no good enough to make something ...</div>
		</div>

			<dl class="postprofile">
			<dt>
				<strong>Festus1965</strong>
			</dt>
			<dd>Member</dd>

		<dd>&nbsp;</dd>

		<dd><strong>Posts:</strong> 966</dd><dd><strong>Joined:</strong> Sun Jan 03, 2016 11:58</dd>
			<dd><strong>GitHub:</strong> Minetest-One</dd>
			<dd><strong>In-game:</strong> Thomas Explorer</dd>
		</dl>
	
		<div class="back2top"><a href="#wrap" class="top" title="Top">Top</a></div>

		<span class="corners-bottom"><span></span></span></div>
	</div>

	<hr class="divider" />
	<div id="p349127" class="post bg2">
		<div class="inner"><span class="corners-top"><span></span></span>

		<div class="postbody">
			<h3 class="first"><a href="https://sorcerykid.github.io/minetest-forums/pages/9_22555.htm#p349127">Re: [Mod]FFIopt [ffiopt]</a></h3>
			<p class="author"><img src="./styles/prosilver/imageset/icon_post_target.gif" width="11" height="9" alt="Post" title="Post" />by <strong>runs</strong> &raquo; Thu Apr 18, 2019 10:02 </p>

			<div class="content"><blockquote><div><cite>Festus1965 wrote:</cite>I am <a href="https://forum.minetest.net/viewtopic.php?f=10&amp;t=22041&amp;p=349124#p349124" class="postlink">using it actual</a>, got the patch done, mod active<br />thanks, I was reading that about the FFI, but no good enough to make something ...</div></blockquote><br /><br />You said that consumes much more memory...</div>
		</div>

			<dl class="postprofile">
			<dt>
				<strong>runs</strong>
			</dt>
			<dd>Member</dd>

		<dd>&nbsp;</dd>

		<dd><strong>Posts:</strong> 377</dd><dd><strong>Joined:</strong> Sat Oct 27, 2018 08:32</dd>
			<dd><strong>GitHub:</strong> runsy</dd>
			
		</dl>
	
		<div class="back2top"><a href="#wrap" class="top" title="Top">Top</a></div>

		<span class="corners-bottom"><span></span></span></div>
	</div>

	<hr class="divider" />
	<div id="p349131" class="post bg1">
		<div class="inner"><span class="corners-top"><span></span></span>

		<div class="postbody">
			<h3 class=""><a href="https://sorcerykid.github.io/minetest-forums/pages/9_22555.htm#p349131">Re: [Mod]FFIopt [ffiopt]</a></h3>
			<p class="author"><img src="./styles/prosilver/imageset/icon_post_target.gif" width="11" height="9" alt="Post" title="Post" />by <strong>Festus1965</strong> &raquo; Thu Apr 18, 2019 10:21 </p>

			<div class="content"><blockquote><div><cite>runs wrote:</cite>You said that consumes much more memory...</div></blockquote> Nope,<br />I <span style="font-weight: bold">wrote</span> that compare to just before used configuration for 6 days, the minimum was 66 MB, <br />then the one just for a view hours used 51 MB at start (no [Mod] time, updated [Mod] EUban), <br />and this new one used once (mean not confirmed, as also [Mod] time is back) was using more, as 78 MB<br />but I updated the collect-garbage result after one hour and there are 52 MB used now.<br /><br />So as there are only 2 changes left: update [mod] EUban and new [Mod] ffiopt - what is the reason ?<br />I think that might be more about better EUban, but how often I have to start both versions (with/-out ffiopt) to be sure ?</div>
		</div>

			<dl class="postprofile">
			<dt>
				<strong>Festus1965</strong>
			</dt>
			<dd>Member</dd>

		<dd>&nbsp;</dd>

		<dd><strong>Posts:</strong> 966</dd><dd><strong>Joined:</strong> Sun Jan 03, 2016 11:58</dd>
			<dd><strong>GitHub:</strong> Minetest-One</dd>
			<dd><strong>In-game:</strong> Thomas Explorer</dd>
		</dl>
	
		<div class="back2top"><a href="#wrap" class="top" title="Top">Top</a></div>

		<span class="corners-bottom"><span></span></span></div>
	</div>

	<hr class="divider" />
	<div id="p349192" class="post bg2">
		<div class="inner"><span class="corners-top"><span></span></span>

		<div class="postbody">
			<h3 class="first"><a href="https://sorcerykid.github.io/minetest-forums/pages/9_22555.htm#p349192">Re: [Mod]FFIopt [ffiopt]</a></h3>
			<p class="author"><img src="./styles/prosilver/imageset/icon_post_target.gif" width="11" height="9" alt="Post" title="Post" />by <strong>Festus1965</strong> &raquo; Fri Apr 19, 2019 01:23 </p>

			<div class="content">but I found another problem<br />description here: server <a href="https://forum.minetest.net/viewtopic.php?f=10&amp;t=22041&amp;p=349191#p349191" class="postlink">ffiopt and worldedit</a> seam have a problem with other<br /><br />WorldEdit didn't work when ffiopt true</div>
		</div>

			<dl class="postprofile">
			<dt>
				<strong>Festus1965</strong>
			</dt>
			<dd>Member</dd>

		<dd>&nbsp;</dd>

		<dd><strong>Posts:</strong> 966</dd><dd><strong>Joined:</strong> Sun Jan 03, 2016 11:58</dd>
			<dd><strong>GitHub:</strong> Minetest-One</dd>
			<dd><strong>In-game:</strong> Thomas Explorer</dd>
		</dl>
	
		<div class="back2top"><a href="#wrap" class="top" title="Top">Top</a></div>

		<span class="corners-bottom"><span></span></span></div>
	</div>

	<hr class="divider" />
	<div id="p349199" class="post bg1">
		<div class="inner"><span class="corners-top"><span></span></span>

		<div class="postbody">
			<h3 class=""><a href="https://sorcerykid.github.io/minetest-forums/pages/9_22555.htm#p349199">Re: [Mod]FFIopt [ffiopt]</a></h3>
			<p class="author"><img src="./styles/prosilver/imageset/icon_post_target.gif" width="11" height="9" alt="Post" title="Post" />by <strong>Pyrollo</strong> &raquo; Fri Apr 19, 2019 06:40 </p>

			<div class="content">Mmmhh.. <br /><br />Worldedit uses voxelmanip in a non usual way and does not use VoxelManip:get_data. Some change required to make it compatible.</div>
		</div>

			<dl class="postprofile">
			<dt>
				<strong>Pyrollo</strong>
			</dt>
			<dd>Member</dd>

		<dd>&nbsp;</dd>

		<dd><strong>Posts:</strong> 261</dd><dd><strong>Joined:</strong> Mon Jan 08, 2018 15:14</dd>
			<dd><strong>GitHub:</strong> pyrollo</dd>
			<dd><strong>In-game:</strong> Naj</dd>
		</dl>
	
		<div class="back2top"><a href="#wrap" class="top" title="Top">Top</a></div>

		<span class="corners-bottom"><span></span></span></div>
	</div>

	<hr class="divider" />
	<div id="p349201" class="post bg2">
		<div class="inner"><span class="corners-top"><span></span></span>

		<div class="postbody">
			<h3 class="first"><a href="https://sorcerykid.github.io/minetest-forums/pages/9_22555.htm#p349201">Re: [Mod]FFIopt [ffiopt]</a></h3>
			<p class="author"><img src="./styles/prosilver/imageset/icon_post_target.gif" width="11" height="9" alt="Post" title="Post" />by <strong>Pyrollo</strong> &raquo; Fri Apr 19, 2019 06:53 </p>

			<div class="content">New issue opened: <!-- m --><a class="postlink" href="https://github.com/EvidenceBKidscode/ffiopt/issues/1">https://github.com/EvidenceBKidscode/ffiopt/issues/1</a><!-- m --><br /><br />If you have any issue, please don't hesitate to report them in Github.</div>
		</div>

			<dl class="postprofile">
			<dt>
				<strong>Pyrollo</strong>
			</dt>
			<dd>Member</dd>

		<dd>&nbsp;</dd>

		<dd><strong>Posts:</strong> 261</dd><dd><strong>Joined:</strong> Mon Jan 08, 2018 15:14</dd>
			<dd><strong>GitHub:</strong> pyrollo</dd>
			<dd><strong>In-game:</strong> Naj</dd>
		</dl>
	
		<div class="back2top"><a href="#wrap" class="top" title="Top">Top</a></div>

		<span class="corners-bottom"><span></span></span></div>
	</div>

	<hr class="divider" />
	<div id="p349317" class="post bg1">
		<div class="inner"><span class="corners-top"><span></span></span>

		<div class="postbody">
			<h3 class=""><a href="https://sorcerykid.github.io/minetest-forums/pages/9_22555.htm#p349317">Re: [Mod]FFIopt [ffiopt]</a></h3>
			<p class="author"><img src="./styles/prosilver/imageset/icon_post_target.gif" width="11" height="9" alt="Post" title="Post" />by <strong>pgimeno</strong> &raquo; Sun Apr 21, 2019 17:37 </p>

			<div class="content">Sorry, I'm no longer registered in Microsoft GitHub and I'm not planing to return, so I can't submit issues there.<br /><br />I see several issues with this mod.<br /><br />First and foremost, security. I see two issues in this respect:<br /><br />- It's exposing the FFI interface publicly, which basically defeats the purpose of having mod security. Any mod can, through the exposed FFI interface, call any C library function including, but not limited to, fopen and fwrite.<br />- Besides that, the pointer to the data is available in the table itself. This makes it possible (through use of large or negative indexes) to access any arbitrary memory position, which could potentially expose passwords or other stuff to untrusted mods.<br /><br />Next is the use of a long int, and subsequently a Lua number (double precision float), to hold a pointer. This is not portable, and it may cause issues in some platform. It may turn out, by pure luck, to work fine in all platforms that Minetest supports, though.<br /><br />Then, the benchmarks do not use the buffer version of the functions, which are designed to prevent object creation and internal reallocation, therefore it's not really a very fair comparison for well-written mods.<br /><br />Lastly, it does not patch the functions with the new spellings: get_2d_map_flat et al.<br /><br />I wrote a PR for Minetest that exposed C functions that could be called through FFI, to let modders handle this manually, but it was not taken with a lot of enthusiasm by the core developers. See <!-- m --><a class="postlink" href="https://github.com/minetest/minetest/pull/6863">https://github.com/minetest/minetest/pull/6863</a><!-- m --> (all appearances of 'ghost' I can see as of this date are my posts).</div>
		</div>

			<dl class="postprofile">
			<dt>
				<strong>pgimeno</strong>
			</dt>
			<dd>New member</dd>

		<dd>&nbsp;</dd>

		<dd><strong>Posts:</strong> 2</dd><dd><strong>Joined:</strong> Sun Apr 21, 2019 16:18</dd>
			
			<dd><strong>In-game:</strong> pgmine</dd>
		</dl>
	
		<div class="back2top"><a href="#wrap" class="top" title="Top">Top</a></div>

		<span class="corners-bottom"><span></span></span></div>
	</div>

	<hr class="divider" />
	<div id="p349318" class="post bg2">
		<div class="inner"><span class="corners-top"><span></span></span>

		<div class="postbody">
			<h3 class="first"><a href="https://sorcerykid.github.io/minetest-forums/pages/9_22555.htm#p349318">Re: [Mod]FFIopt [ffiopt]</a></h3>
			<p class="author"><img src="./styles/prosilver/imageset/icon_post_target.gif" width="11" height="9" alt="Post" title="Post" />by <strong>rubenwardy</strong> &raquo; Sun Apr 21, 2019 18:05 </p>

			<div class="content"><blockquote><div><cite>pgimeno wrote:</cite>I wrote a PR for Minetest that exposed C functions that could be called through FFI, to let modders handle this manually, but it was not taken with a lot of enthusiasm by the core developers. See <!-- m --><a class="postlink" href="https://github.com/minetest/minetest/pull/6863">https://github.com/minetest/minetest/pull/6863</a><!-- m --> (all appearances of 'ghost' I can see as of this date are my posts).</div></blockquote><br /><br />I really like this feature and it had the potential reduce OOMs and improve performance - but you yourself said that the performance improvement was negligible</div>
		</div>

			<dl class="postprofile">
			<dt>
				<strong>rubenwardy</strong>
			</dt>
			<dd>Moderator</dd>

		<dd>&nbsp;</dd>

		<dd><strong>Posts:</strong> 5737</dd><dd><strong>Joined:</strong> Tue Jun 12, 2012 18:11</dd>
			<dd><strong>GitHub:</strong> rubenwardy</dd>
			<dd><strong>In-game:</strong> rubenwardy</dd>
		</dl>
	
		<div class="back2top"><a href="#wrap" class="top" title="Top">Top</a></div>

		<span class="corners-bottom"><span></span></span></div>
	</div>

	<hr class="divider" />
	<div id="p349320" class="post bg1">
		<div class="inner"><span class="corners-top"><span></span></span>

		<div class="postbody">
			<h3 class=""><a href="https://sorcerykid.github.io/minetest-forums/pages/9_22555.htm#p349320">Re: [Mod]FFIopt [ffiopt]</a></h3>
			<p class="author"><img src="./styles/prosilver/imageset/icon_post_target.gif" width="11" height="9" alt="Post" title="Post" />by <strong>pgimeno</strong> &raquo; Sun Apr 21, 2019 18:16 </p>

			<div class="content"><blockquote><div><cite>rubenwardy wrote:</cite>I really like this feature and it had the potential reduce OOMs and improve performance - but you yourself said that the performance improvement was negligible<br /></div></blockquote><br />Not negligible, but small in comparison with the processing time required in most use cases (Lua mapgens that process noise for landscaping).<br /><br />That was actually paramat's point: <!-- m --><a class="postlink" href="https://github.com/minetest/minetest/pull/6863#issuecomment-354859130">https://github.com/minetest/minetest/pu ... -354859130</a><!-- m --> and I agreed (edit: <!-- m --><a class="postlink" href="https://github.com/minetest/minetest/pull/6863#issuecomment-355646707">https://github.com/minetest/minetest/pu ... -355646707</a><!-- m -->), but even then I see value in this, because of moving the allocation outside of Lua memory.</div>
		</div>

			<dl class="postprofile">
			<dt>
				<strong>pgimeno</strong>
			</dt>
			<dd>New member</dd>

		<dd>&nbsp;</dd>

		<dd><strong>Posts:</strong> 2</dd><dd><strong>Joined:</strong> Sun Apr 21, 2019 16:18</dd>
			
			<dd><strong>In-game:</strong> pgmine</dd>
		</dl>
	
		<div class="back2top"><a href="#wrap" class="top" title="Top">Top</a></div>

		<span class="corners-bottom"><span></span></span></div>
	</div>

	<hr class="divider" />
	<div id="p349332" class="post bg2">
		<div class="inner"><span class="corners-top"><span></span></span>

		<div class="postbody">
			<h3 class="first"><a href="https://sorcerykid.github.io/minetest-forums/pages/9_22555.htm#p349332">Re: [Mod]FFIopt [ffiopt</nobr>]</a></h3>
			<p class="author"><img src="./styles/prosilver/imageset/icon_post_target.gif" width="11" height="9" alt="Post" title="Post" />by <strong>Pyrollo</strong> &raquo; Sun Apr 21, 2019 20:43 </p>

			<div class="content">Hi pgimeno, thanks a lot for your feedback, many interesting things :)<br /><br />We'll study that closely, trying make mod evolve.<br /><br /><blockquote><div><cite>pgimeno wrote:</cite>Then, the benchmarks do not use the buffer version of the functions, which are designed to prevent object creation and internal reallocation, therefore it's not really a very fair comparison for well-written mods.</div></blockquote><br /><br />I did not take care of this aspect in the benchmark because in various studied options, it turned out that every time passing values through Lua stack was used to retrieve map data, things were slow (tryed to implemet something like get(index) on the C++ side but the get argument value/returning map value took almost the same time than populating the table).<br /><br />For our purpose (changing many nodes at once) using FFI had a noticeable change on performances (but at first we disabled the light calculation on save, way to slow and not necessary for us).<br /><br />On a memory point of view I totally agree with you. Data should not be duplicated to Lua memory.</div>
		</div>

			<dl class="postprofile">
			<dt>
				<strong>Pyrollo</strong>
			</dt>
			<dd>Member</dd>

		<dd>&nbsp;</dd>

		<dd><strong>Posts:</strong> 261</dd><dd><strong>Joined:</strong> Mon Jan 08, 2018 15:14</dd>
			<dd><strong>GitHub:</strong> pyrollo</dd>
			<dd><strong>In-game:</strong> Naj</dd>
		</dl>
	
		<div class="back2top"><a href="#wrap" class="top" title="Top">Top</a></div>

		<span class="corners-bottom"><span></span></span></div>
	</div>

	<hr class="divider" />

	<hr class="divider" />

	<hr />

<div class="topic-actions">
		<div class="pagination">
			13 posts
			 &bull; Page <strong>1</strong> of <strong>1</strong>
		</div>
</div>

	<p></p><p><a href="./viewforum.php?f=9" class="left-box left" accesskey="r">Return to WIP Mods</a></p>

	<br /><br />

	<h3>Who is online</h3>
	<p>Users browsing this forum: <span style="color: #9E8DA7;" class="username-coloured">Yandex Bot [Bot]</span> and 0 guests</p>
</div>

<div id="page-footer">

	<div class="navbar">
		<div class="inner"><span class="corners-top"><span></span></span>

		<ul class="linklist">
			<li class="icon-home"><a href="./index.php">Board index</a></li>
				
			<li class="rightside">All times are UTC </li>
		</ul>

		<span class="corners-bottom"><span></span></span></div>
	</div>

	<div class="copyright">Powered by <a href="https://www.phpbb.com/">phpBB</a>&reg; Forum Software &copy; phpBB Group
		
	</div>
</div>

</div>

<div>
	<a id="bottom" name="bottom" accesskey="z"></a>
	
</div>

</body>
</html></div>
