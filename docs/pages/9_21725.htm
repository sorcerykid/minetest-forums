<!--
  Mintest Forum Recovery Project (by sorcerykid)

  https://sorcerykid.github.io/minetest-forums/pages/9_21725.htm

  The following page was cached by Bing Bot (https://bing.com/) on 26-Apr-2019.
  All archived content is subject to copyright. No warranty or guaranty is implied.
-->
<base href="https://forum.minetest.net/" />
<html xmlns="http://www.w3.org/1999/xhtml" dir="ltr" lang="en-gb" xml:lang="en-gb">
<head>

<meta http-equiv="content-type" content="text/html; charset=UTF-8" />
<meta http-equiv="content-style-type" content="text/css" />
<meta http-equiv="content-language" content="en-gb" />
<meta http-equiv="imagetoolbar" content="no" />
<meta name="resource-type" content="document" />
<meta name="distribution" content="global" />
<meta name="keywords" content="" />
<meta name="description" content="" />

<title>Minetest Forums &bull; View topic - [Mod] Exchange stuff between servers [Interkom]</title>

<link rel="alternate" type="application/atom+xml" title="Feed - Minetest Forums" href="https://forum.minetest.net/feed.php" /><link rel="alternate" type="application/atom+xml" title="Feed - New Topics" href="https://forum.minetest.net/feed.php?mode=topics" /><link rel="alternate" type="application/atom+xml" title="Feed - Forum - Mods" href="https://forum.minetest.net/feed.php?f=46" /><link rel="alternate" type="application/atom+xml" title="Feed - Topic - [Mod] Exchange stuff between servers [Interkom]" href="https://forum.minetest.net/feed.php?f=9&amp;t=21725" />

<!--
	phpBB style name: prosilver
	Based on style:   prosilver (this is the default phpBB3 style)
	Original author:  Tom Beddard ( http://www.subBlue.com/ )
	Modified by:
-->

<link href="./styles/prosilver/theme/print.css" rel="stylesheet" type="text/css" media="print" title="printonly" />
<link href="./style.php?id=5&amp;lang=en" rel="stylesheet" type="text/css" media="screen, projection" />

<link href="./styles/prosilver/theme/normal.css" rel="stylesheet" type="text/css" title="A" />
<link href="./styles/prosilver/theme/medium.css" rel="alternate stylesheet" type="text/css" title="A+" />
<link href="./styles/prosilver/theme/large.css" rel="alternate stylesheet" type="text/css" title="A++" />

</head>

<body id="phpbb" class="section-viewtopic ltr">

<div id="wrap">
	<a id="top" name="top" accesskey="t"></a>
	<div id="page-header">
		<div class="headerbar">
			<div class="inner"><span class="corners-top"><span></span></span>

			<div id="site-description">
				<a href="./index.php" title="Board index" id="logo"><img src="./styles/prosilver/imageset/site_logo.gif" width="149" height="52" alt="" title="" /></a>
				<h1>Minetest Forums</h1>
				<p>The official Minetest discussion board</p>
				<p class="skiplink"><a href="#start_here">Skip to content</a></p>
			</div>

			<span class="corners-bottom"><span></span></span></div>
		</div>

		<div class="navbar">
			<div class="inner"><span class="corners-top"><span></span></span>

			<ul class="linklist navlinks">
				<li class="icon-home"><a href="./index.php" accesskey="h">Board index</a> <strong>&#8249;</strong> <a href="./viewforum.php?f=9">WIP Mods</a></li>
			</ul>

			<span class="corners-bottom"><span></span></span></div>
		</div>
	</div>

	<a name="start_here"></a>
	<div id="page-body">
		
<h2><a href="./viewtopic.php?f=46&amp;t=21725">[Mod] Exchange stuff between servers [Interkom]</a></h2>
<!-- NOTE: remove the style="display: none" when you want to have the forum description on the topic body -->

<div class="topic-actions">
		<div class="pagination">
			19 posts
			 &bull; Page <strong>1</strong> of <strong>1</strong>
		</div>
</div>
<div class="clear"></div>

	<div id="p339930" class="post bg2">
		<div class="inner"><span class="corners-top"><span></span></span>

		<div class="postbody">
			<h3 class="first"><a href="https://sorcerykid.github.io/minetest-forums/pages/9_21725.htm#p339930">[Mod] Exchange stuff between servers [Interkom]</a></h3>
			<p class="author"><img src="./styles/prosilver/imageset/icon_post_target.gif" width="11" height="9" alt="Post" title="Post" />by <strong>Gundul</strong> &raquo; Fri Jan 04, 2019 3:01 pm </p>

			<div class="content"><span style="font-size: 150%; line-height: 116%;"><span style="color: #FF4000"> ! CAUTION !</span></span><br /><span style="color: #00BF00"><br />This mod is wip and in development.<br />Use at your own risk.<br />No garantees, no support, I am not responsible for any loss. :D<br />But do not worry, I have this running for more than half a year and<br />all my servers and harddiscs are still alive </span><br /><br />Dependencies: none  - (adds button to unified_inventory if available)<br />License: <br /><style>
.spoiler {
	border: solid 1px #eee !important;
	border-radius: 0.2em;
	background: #fff;
	padding: 0.5em 0.75em;
	margin: 0.75em 1em
}
.spoiler_header {
	color: #cb4b16;
	cursor: pointer;
	-moz-user-select: none;
	-webkit-user-select: none;
	user-select: none
}
.spoiler_content {
	margin-top: 0.7em !important;
	padding-top: 0.7em !important;
	padding: .35em 0;
	color: #333;
	border-top: dashed 1px #eee !important
}
</style>
<script>
function spoiler_toggle(event) {
	var node = event.target;
	if (node.nodeName != "DIV") {
		node = node.parentNode;
	}
	var contentNode = node.nextSibling;
	if (contentNode && contentNode.className == "spoiler_content") {
		if(contentNode.style.display == "none") {
			contentNode.style.display = "block";
			node.firstChild.firstChild.nodeValue = "-";
		} else {
			contentNode.style.display = "none";
			node.firstChild.firstChild.nodeValue = "+";
		}
		return false;
	}
	return true;
}
</script>
<div class="spoiler">
	<div class="spoiler_header" onClick="spoiler_toggle(event);"><b>+</b>
		Spoiler
	</div><div class="spoiler_content" style="display: none;">
		DO WHAT THE FUCK YOU WANT TO PUBLIC LICENSE<br />                    Version 2, December 2004<br /><br /> Copyright &#40;C&#41; 2004 Sam Hocevar<br />  14 rue de Plaisance, 75014 Paris, France<br /> Everyone is permitted to copy and distribute verbatim or modified<br /> copies of this license document, and changing it is allowed as long<br /> as the name is changed.<br /><br />            DO WHAT THE FUCK YOU WANT TO PUBLIC LICENSE<br />   TERMS AND CONDITIONS FOR COPYING, DISTRIBUTION AND MODIFICATION<br /><br />  0. You just DO WHAT THE FUCK YOU WANT TO.
	</div>
</div><br /><br />This mod works, proofed on the following connected servers:<br /><span style="color: #0040BF">&quot;Jungle&quot;<br />&quot;Lilly in the valley&quot;<br />&quot;LouisZ&quot;  (not in serverlist)</span><br /><br />You need to setup a synchronized folder if you want to connect servers.<br />By default this folder must be in your world directory named &quot;Lilly&quot;<br />for example ~/.minetest/worlds/myworld/Lilly<br /><br />With this mod it is possible to transfer stuff from one server to an other. It also works<br />on one server only, but /give command is a bit faster :)<br />All can be send, except tools or nodes containing metadata. You are free to use what ever<br />mods you want on each server because interkom will know what is known and which nodes<br />not. Unknown things will return to sender.<br /><br /><br />Sorry no pictures as this mod only works with chatcommands so far:<br /><ul><span style="color: #004080">/interkom</span><br />This will show you a chart of all connected servers with its players<br /><br /><span style="color: #004080">/pm player,server,message</span><br />Will send a private message to player@server<br /><br /><span style="color: #004080">/stuff player,server,stuff</span><br />Will send &quot;stuff&quot; to player@server, where stuff is an itemstack like &quot;default:stone 25&quot;<br /><br /><span style="color: #004080">/ok</span><br />Will accept what a player wants to send you and puts him on the whitelist<br /><br /><span style="color: #004080">/bl player@server</span><br />puts player@server on the blacklist again<br /></ul><br /><br />So far it works on above servers, I will add other features in the future and maybe a<br />gui too. Any suggestions post here please.<br /><br />download here: <a href="https://github.com/berengma/interkom/archive/master.zip" class="postlink">https://github.com/berengma/interkom/archive/master.zip</a><br />Sourcecode here: <a href="https://github.com/berengma/interkom" class="postlink">https://github.com/berengma/interkom</a><br /><br /><br />Gundul</div>
		</div>

			<dl class="postprofile">
			<dt>
				<strong>Gundul</strong>
			</dt>
			<dd>Member</dd>

		<dd>&nbsp;</dd>

		<dd><strong>Posts:</strong> 416</dd><dd><strong>Joined:</strong> Thu Aug 27, 2015 10:55 am</dd>
			<dd><strong>GitHub:</strong> berengma</dd>
			
		</dl>
	
		<div class="back2top"><a href="#wrap" class="top" title="Top">Top</a></div>

		<span class="corners-bottom"><span></span></span></div>
	</div>

	<hr class="divider" />
	<div id="p339965" class="post bg1">
		<div class="inner"><span class="corners-top"><span></span></span>

		<div class="postbody">
			<h3 class=""><a href="https://sorcerykid.github.io/minetest-forums/pages/9_21725.htm#p339965">Re: [Mod] Exchange stuff between servers [Interkom]</a></h3>
			<p class="author"><img src="./styles/prosilver/imageset/icon_post_target.gif" width="11" height="9" alt="Post" title="Post" />by <strong>sofar</strong> &raquo; Fri Jan 04, 2019 6:48 pm </p>

			<div class="content">This code looks super iffy. A fun read to find input validation issues so people can send arbitrary stuff they don't have to players on other servers. Are you sure you're checking all the input correctly? Did you protect against races and properly lock the transfer files?<br /><br />You should post the dependencies and license in the forum thread. See sticky topic.</div>
		</div>

			<dl class="postprofile">
			<dt>
				<strong>sofar</strong>
			</dt>
			<dd>Developer</dd>

		<dd>&nbsp;</dd>

		<dd><strong>Posts:</strong> 2081</dd><dd><strong>Joined:</strong> Fri Jan 16, 2015 7:31 am</dd>
			<dd><strong>GitHub:</strong> sofar</dd>
			<dd><strong>In-game:</strong> sofar</dd>
		</dl>
	
		<div class="back2top"><a href="#wrap" class="top" title="Top">Top</a></div>

		<span class="corners-bottom"><span></span></span></div>
	</div>

	<hr class="divider" />
	<div id="p340035" class="post bg2">
		<div class="inner"><span class="corners-top"><span></span></span>

		<div class="postbody">
			<h3 class=""><a href="https://sorcerykid.github.io/minetest-forums/pages/9_21725.htm#p340035">Re: [Mod] Exchange stuff between servers [Interkom]</a></h3>
			<p class="author"><img src="./styles/prosilver/imageset/icon_post_target.gif" width="11" height="9" alt="Post" title="Post" />by <strong>Gundul</strong> &raquo; Sat Jan 05, 2019 3:42 pm </p>

			<div class="content"><blockquote><div><cite>sofar wrote:</cite>This code looks super iffy.</div></blockquote> <br />just for the record:<br /><ul>-I do not post something &quot;iffy&quot; in mods section, this works for months without iussues on my two public servers<br />-We are here in wip mods section.Wip means: work in progress.<br />  Do not expect something here what would not needed to be worked on.</ul><br /><blockquote><div><cite>sofar wrote:</cite>A fun read to find input validation issues so people can send arbitrary stuff they don't have to players on other servers. Are you sure you're checking all the input correctly? Did you protect against races and properly lock the transfer files?</div></blockquote><br />Exaggerated a bit ? <br />But I am always happy other people have fun with my developments. Any proove, example maybe ?<br />I am repeating myself, this mod is running for months on my servers without trouble.</div>
		</div>

			<dl class="postprofile">
			<dt>
				<strong>Gundul</strong>
			</dt>
			<dd>Member</dd>

		<dd>&nbsp;</dd>

		<dd><strong>Posts:</strong> 416</dd><dd><strong>Joined:</strong> Thu Aug 27, 2015 10:55 am</dd>
			<dd><strong>GitHub:</strong> berengma</dd>
			
		</dl>
	
		<div class="back2top"><a href="#wrap" class="top" title="Top">Top</a></div>

		<span class="corners-bottom"><span></span></span></div>
	</div>

	<hr class="divider" />
	<div id="p340044" class="post bg1">
		<div class="inner"><span class="corners-top"><span></span></span>

		<div class="postbody">
			<h3 class=""><a href="https://sorcerykid.github.io/minetest-forums/pages/9_21725.htm#p340044">Re: [Mod] Exchange stuff between servers [Interkom]</a></h3>
			<p class="author"><img src="./styles/prosilver/imageset/icon_post_target.gif" width="11" height="9" alt="Post" title="Post" />by <strong>sofar</strong> &raquo; Sat Jan 05, 2019 6:07 pm </p>

			<div class="content"><blockquote><div><cite>Gundul wrote:</cite><blockquote><div><cite>sofar wrote:</cite>This code looks super iffy.</div></blockquote> <br />just for the record:<br /><ul>-I do not post something &quot;iffy&quot; in mods section, this works for months without iussues on my two public servers<br />-We are here in wip mods section.Wip means: work in progress.<br />  Do not expect something here what would not needed to be worked on.</ul><br /><blockquote><div><cite>sofar wrote:</cite>A fun read to find input validation issues so people can send arbitrary stuff they don't have to players on other servers. Are you sure you're checking all the input correctly? Did you protect against races and properly lock the transfer files?</div></blockquote><br />Exaggerated a bit ? <br />But I am always happy other people have fun with my developments. Any proove, example maybe ?<br />I am repeating myself, this mod is running for months on my servers without trouble.</div></blockquote><br /><br />If I reply with concerns then it means (1) I generally like the code/mod/idea, and (2) I care enough to voice my concerns in case that I think it's warranted. It's not a personal attack, obviously, I never said &quot;Oh gundul has the nerve to tickle a wombat!&quot;, instead I said &quot;this code looks suspect (iffy)&quot; with the intent of making you critically think about whether this is actually secure or not.<br /><br />It obviously works, I don't doubt it. What I doubt is that if players send requests at the same time that both actually arrive intact. Since the receiving server can't verify that the items are in the senders' inventory, it's not hard to think of a possible exploit to generate some message that gets the receiver lots of items that the sender never had, or just corrupt the messages. There's also some splitting of user input going on without escaping, so there's a possibility of people throwing weird characters at you that you didn't think of (&quot;\n&quot;) and may end up in your transfer file.<br /><br />It's not my code, if you don't want to secure it more, that's your perogative. But now that you've posted the code, if there is an exploit possible, anyone can find it.</div>
		</div>

			<dl class="postprofile">
			<dt>
				<strong>sofar</strong>
			</dt>
			<dd>Developer</dd>

		<dd>&nbsp;</dd>

		<dd><strong>Posts:</strong> 2081</dd><dd><strong>Joined:</strong> Fri Jan 16, 2015 7:31 am</dd>
			<dd><strong>GitHub:</strong> sofar</dd>
			<dd><strong>In-game:</strong> sofar</dd>
		</dl>
	
		<div class="back2top"><a href="#wrap" class="top" title="Top">Top</a></div>

		<span class="corners-bottom"><span></span></span></div>
	</div>

	<hr class="divider" />
	<div id="p340047" class="post bg2">
		<div class="inner"><span class="corners-top"><span></span></span>

		<div class="postbody">
			<h3 class=""><a href="https://sorcerykid.github.io/minetest-forums/pages/9_21725.htm#p340047">Re: [Mod] Exchange stuff between servers [Interkom]</a></h3>
			<p class="author"><img src="./styles/prosilver/imageset/icon_post_target.gif" width="11" height="9" alt="Post" title="Post" />by <strong>Krock</strong> &raquo; Sat Jan 05, 2019 6:42 pm </p>

			<div class="content">I wondered how &quot;iffy&quot; the code actually is and only figured out some minor issues:<br /><br />1) Unreliable file writing. I'd rather use `minetest.safe_write_file` to ensure everything is written correctly in case the server is not shut down correctly.<br />2) Writing to the file at the same time: If server 1 writes to the file whereas server 2 deletes an entry from the file, there may be a file corruption. Not sure though, how this could be solved.<br />3) If you ever allow metadata: New lines and commas would break the system. There's no escape handling in your custom string.split implementation and new lines would destroy the format. Luckily you treat items with metadata like tools (disallowed), even though they could be stackable.<br /><br />It was however interesting to see this mix of tabs and spaces. I think you're using four spaces, but the editor does not convert existing tabs when you indent the code.</div>
		</div>

			<dl class="postprofile">
			<dt>
				<strong>Krock</strong>
			</dt>
			<dd>Developer</dd>

		<dd>&nbsp;</dd>

		<dd><strong>Posts:</strong> 4229</dd><dd><strong>Joined:</strong> Thu Oct 03, 2013 7:48 am</dd>
			<dd><strong>GitHub:</strong> SmallJoker</dd>
			
		</dl>
	
		<div class="back2top"><a href="#wrap" class="top" title="Top">Top</a></div>

		<span class="corners-bottom"><span></span></span></div>
	</div>

	<hr class="divider" />
	<div id="p340157" class="post bg1">
		<div class="inner"><span class="corners-top"><span></span></span>

		<div class="postbody">
			<h3 class=""><a href="https://sorcerykid.github.io/minetest-forums/pages/9_21725.htm#p340157">Re: [Mod] Exchange stuff between servers [Interkom]</a></h3>
			<p class="author"><img src="./styles/prosilver/imageset/icon_post_target.gif" width="11" height="9" alt="Post" title="Post" />by <strong>Gundul</strong> &raquo; Sun Jan 06, 2019 11:36 am </p>

			<div class="content"><blockquote><div><cite>sofar wrote:</cite><br />If I reply with concerns then it means (1) I generally like the code/mod/idea, and (2) I care enough to voice my concerns in case that I think it's warranted. It's not a personal attack, obviously, I never said &quot;Oh gundul has the nerve to tickle a wombat!&quot;, instead I said &quot;this code looks suspect (iffy)&quot; with the intent of making you critically think about whether this is actually secure or not.<br /></div></blockquote><br />Sorry for getting you wrong, engish is not my native language and &quot;iffy&quot; is not the word we would use in a situation like this.<br /><br /><blockquote><div><cite>sofar wrote:</cite>It obviously works, I don't doubt it. What I doubt is that if players send requests at the same time that both actually arrive intact. Since the receiving server can't verify that the items are in the senders' inventory, it's not hard to think of a possible exploit to generate some message that gets the receiver lots of items that the sender never had, or just corrupt the messages. There's also some splitting of user input going on without escaping, so there's a possibility of people throwing weird characters at you that you didn't think of (&quot;\n&quot;) and may end up in your transfer file.<br /></div></blockquote><br />The security is always at my mind. But it is only about sharing some stuff between servers. Worst that could happen is someone getting lots of stuff he did not have. And I get the debug for free and can work with that. :) <br />I already updated some parts of the code checking more detailed for nodenames.<br /><br /><blockquote><div><cite>sofar wrote:</cite>It's not my code, if you don't want to secure it more, that's your perogative. But now that you've posted the code, if there is an exploit possible, anyone can find it.</div></blockquote><br />I will make it as secure as I am able to do, that is why I post it now and not already did when I first put the mod <br />online. That is also why I put the warning caution and do not describe more in detail how to synchronize folders.<br />Everybody must decide this for his own. Not to forget that exploits also can have positve effects when server and<br />running software are well monitored.</div>
		</div>

			<dl class="postprofile">
			<dt>
				<strong>Gundul</strong>
			</dt>
			<dd>Member</dd>

		<dd>&nbsp;</dd>

		<dd><strong>Posts:</strong> 416</dd><dd><strong>Joined:</strong> Thu Aug 27, 2015 10:55 am</dd>
			<dd><strong>GitHub:</strong> berengma</dd>
			
		</dl>
	
		<div class="back2top"><a href="#wrap" class="top" title="Top">Top</a></div>

		<span class="corners-bottom"><span></span></span></div>
	</div>

	<hr class="divider" />
	<div id="p340159" class="post bg2">
		<div class="inner"><span class="corners-top"><span></span></span>

		<div class="postbody">
			<h3 class=""><a href="https://sorcerykid.github.io/minetest-forums/pages/9_21725.htm#p340159">Re: [Mod] Exchange stuff between servers [Interkom]</a></h3>
			<p class="author"><img src="./styles/prosilver/imageset/icon_post_target.gif" width="11" height="9" alt="Post" title="Post" />by <strong>Gundul</strong> &raquo; Sun Jan 06, 2019 11:48 am </p>

			<div class="content"><blockquote><div><cite>Krock wrote:</cite>I wondered how &quot;iffy&quot; the code actually is and only figured out some minor issues:<br /><br />1) Unreliable file writing. I'd rather use `minetest.safe_write_file` to ensure everything is written correctly in case the server is not shut down correctly.<br /></div></blockquote><br />Thank you, I did not know that exists in the minetest api.<br /><br /><blockquote><div><cite>Krock wrote:</cite>2) Writing to the file at the same time: If server 1 writes to the file whereas server 2 deletes an entry from the file, there may be a file corruption. Not sure though, how this could be solved.<br /></div></blockquote><br />I had this in my mind. But I must confess I have no solution for this, too. I was thinking that the software which synchs the folders would take care of this maybe.<br /><br /><blockquote><div><cite>Krock wrote:</cite>3) If you ever allow metadata: New lines and commas would break the system. There's no escape handling in your custom string.split implementation and new lines would destroy the format. Luckily you treat items with metadata like tools (disallowed), even though they could be stackable.<br /></div></blockquote><br />I do not plan to allow metadata. This is not wanted now and in the near future.<br />Maybe all this can be done with a gui in the future, but only if this really runs reliable.<br /><br />Items with metadata could be stackable, yes. But in that case the metadata would be lost if sent to an other server.<br /><br /><blockquote><div><cite>Krock wrote:</cite>It was however interesting to see this mix of tabs and spaces. I think you're using four spaces, but the editor does not convert existing tabs when you indent the code.</div></blockquote><br />Sorry, which tabs and spaces you mean ?</div>
		</div>

			<dl class="postprofile">
			<dt>
				<strong>Gundul</strong>
			</dt>
			<dd>Member</dd>

		<dd>&nbsp;</dd>

		<dd><strong>Posts:</strong> 416</dd><dd><strong>Joined:</strong> Thu Aug 27, 2015 10:55 am</dd>
			<dd><strong>GitHub:</strong> berengma</dd>
			
		</dl>
	
		<div class="back2top"><a href="#wrap" class="top" title="Top">Top</a></div>

		<span class="corners-bottom"><span></span></span></div>
	</div>

	<hr class="divider" />
	<div id="p340160" class="post bg1">
		<div class="inner"><span class="corners-top"><span></span></span>

		<div class="postbody">
			<h3 class=""><a href="https://sorcerykid.github.io/minetest-forums/pages/9_21725.htm#p340160">Re: [Mod] Exchange stuff between servers [Interkom]</a></h3>
			<p class="author"><img src="./styles/prosilver/imageset/icon_post_target.gif" width="11" height="9" alt="Post" title="Post" />by <strong>Krock</strong> &raquo; Sun Jan 06, 2019 11:56 am </p>

			<div class="content"><blockquote><div><cite>Gundul wrote:</cite>Items with metadata could be stackable, yes. But in that case the metadata would be lost if sent to an other server.</div></blockquote><br />Ah okay. I didn't look at the code for a too long time to notice that behaviour.<br /><br /><blockquote><div><cite>Gundul wrote:</cite>Sorry, which tabs and spaces you mean ?</div></blockquote><br />These particular lines are interesting: <!-- m --><a class="postlink" href="https://github.com/berengma/interkom/blob/master/init.lua#L233-L239">https://github.com/berengma/interkom/bl ... #L233-L239</a><!-- m --><br />space-only indents: 3/7 lines<br />1x tab, spaces: 1/7 lines<br />tab-only indents: 3/7 lines<br /><br />Not important in terms of functionality but looks a bit as if you copies&amp;pasted multiple mods into this one.</div>
		</div>

			<dl class="postprofile">
			<dt>
				<strong>Krock</strong>
			</dt>
			<dd>Developer</dd>

		<dd>&nbsp;</dd>

		<dd><strong>Posts:</strong> 4229</dd><dd><strong>Joined:</strong> Thu Oct 03, 2013 7:48 am</dd>
			<dd><strong>GitHub:</strong> SmallJoker</dd>
			
		</dl>
	
		<div class="back2top"><a href="#wrap" class="top" title="Top">Top</a></div>

		<span class="corners-bottom"><span></span></span></div>
	</div>

	<hr class="divider" />
	<div id="p340209" class="post bg2">
		<div class="inner"><span class="corners-top"><span></span></span>

		<div class="postbody">
			<h3 class=""><a href="https://sorcerykid.github.io/minetest-forums/pages/9_21725.htm#p340209">Re: [Mod] Exchange stuff between servers [Interkom]</a></h3>
			<p class="author"><img src="./styles/prosilver/imageset/icon_post_target.gif" width="11" height="9" alt="Post" title="Post" />by <strong>sofar</strong> &raquo; Sun Jan 06, 2019 7:54 pm </p>

			<div class="content">My initial thoughts on this mod are to secure the wire protocol and not use files as they are obviously prone to locking issues (as lua does none) and 2 servers could write the same file at the same time. A better implementation would be to use sockets to do all the communication, where each server has a &quot;receive&quot; socket, and the sender transmits by sending some json encoded structural content.<br /><br />The chatcommands and parsing of input are difficult things to get right (does it handle utf8 properly?) so I would think about replacing the chatcommands with a properly secured formspec where players need to put the actual items in a send slot, which also takes the trouble of knowing the item names away for players. You could use the sockets to send player lists to each server so that players know who is online or not and have the form display this, or maintain a friend list or something like that.</div>
		</div>

			<dl class="postprofile">
			<dt>
				<strong>sofar</strong>
			</dt>
			<dd>Developer</dd>

		<dd>&nbsp;</dd>

		<dd><strong>Posts:</strong> 2081</dd><dd><strong>Joined:</strong> Fri Jan 16, 2015 7:31 am</dd>
			<dd><strong>GitHub:</strong> sofar</dd>
			<dd><strong>In-game:</strong> sofar</dd>
		</dl>
	
		<div class="back2top"><a href="#wrap" class="top" title="Top">Top</a></div>

		<span class="corners-bottom"><span></span></span></div>
	</div>

	<hr class="divider" />
	<div id="p340249" class="post bg1">
		<div class="inner"><span class="corners-top"><span></span></span>

		<div class="postbody">
			<h3 class=""><a href="https://sorcerykid.github.io/minetest-forums/pages/9_21725.htm#p340249">Re: [Mod] Exchange stuff between servers [Interkom]</a></h3>
			<p class="author"><img src="./styles/prosilver/imageset/icon_post_target.gif" width="11" height="9" alt="Post" title="Post" />by <strong>Lone_Wolf</strong> &raquo; Mon Jan 07, 2019 1:43 am </p>

			<div class="content"><blockquote><div><cite>Gundul wrote:</cite><blockquote><div><cite>Krock wrote:</cite>2) Writing to the file at the same time: If server 1 writes to the file whereas server 2 deletes an entry from the file, there may be a file corruption. Not sure though, how this could be solved.<br /></div></blockquote><br />I had this in my mind. But I must confess I have no solution for this, too. I was thinking that the software which synchs the folders would take care of this maybe.</div></blockquote><br />I'm not sure of how everything works in your system but you might be able to create a 'status file' for each server in the folder and set it up so that before a server writes anything it checks the other server's status files. <br />If none of the other servers is writing have it set the contents of its status file to something that says it's writing to a file.<br />Make it write to the file it was originally going to write to, and when it finishes you can make it rewrite it's status file to something saying it's not writing<br /><br />I hope that's readable...</div>
		</div>

			<dl class="postprofile">
			<dt>
				<strong>Lone_Wolf</strong>
			</dt>
			<dd>Member</dd>

		<dd>&nbsp;</dd>

		<dd><strong>Posts:</strong> 2150</dd><dd><strong>Joined:</strong> Sun Apr 09, 2017 5:50 am</dd>
			<dd><strong>GitHub:</strong> LoneWolfHT</dd>
			<dd><strong>In-game:</strong> Lone_Wolf</dd>
		</dl>
	
		<div class="back2top"><a href="#wrap" class="top" title="Top">Top</a></div>

		<span class="corners-bottom"><span></span></span></div>
	</div>

	<hr class="divider" />
	<div id="p340252" class="post bg2">
		<div class="inner"><span class="corners-top"><span></span></span>

		<div class="postbody">
			<h3 class=""><a href="https://sorcerykid.github.io/minetest-forums/pages/9_21725.htm#p340252">Re: [Mod] Exchange stuff between servers [Interkom]</a></h3>
			<p class="author"><img src="./styles/prosilver/imageset/icon_post_target.gif" width="11" height="9" alt="Post" title="Post" />by <strong>sofar</strong> &raquo; Mon Jan 07, 2019 2:35 am </p>

			<div class="content"><blockquote><div><cite>Lone_Wolf wrote:</cite>I'm not sure of how everything works in your system but you might be able to create a 'status file' for each server in the folder and set it up so that before a server writes anything it checks the other server's status files. <br />If none of the other servers is writing have it set the contents of its status file to something that says it's writing to a file.<br />Make it write to the file it was originally going to write to, and when it finishes you can make it rewrite it's status file to something saying it's not writing<br /><br />I hope that's readable...</div></blockquote><br /><br />Now you just created a second locking problem with the state file. :)</div>
		</div>

			<dl class="postprofile">
			<dt>
				<strong>sofar</strong>
			</dt>
			<dd>Developer</dd>

		<dd>&nbsp;</dd>

		<dd><strong>Posts:</strong> 2081</dd><dd><strong>Joined:</strong> Fri Jan 16, 2015 7:31 am</dd>
			<dd><strong>GitHub:</strong> sofar</dd>
			<dd><strong>In-game:</strong> sofar</dd>
		</dl>
	
		<div class="back2top"><a href="#wrap" class="top" title="Top">Top</a></div>

		<span class="corners-bottom"><span></span></span></div>
	</div>

	<hr class="divider" />
	<div id="p340277" class="post bg1">
		<div class="inner"><span class="corners-top"><span></span></span>

		<div class="postbody">
			<h3 class=""><a href="https://sorcerykid.github.io/minetest-forums/pages/9_21725.htm#p340277">Re: [Mod] Exchange stuff between servers [Interkom]</a></h3>
			<p class="author"><img src="./styles/prosilver/imageset/icon_post_target.gif" width="11" height="9" alt="Post" title="Post" />by <strong>Gundul</strong> &raquo; Mon Jan 07, 2019 11:02 am </p>

			<div class="content"><blockquote><div><cite>Lone_Wolf wrote:</cite>Make it write to the file it was originally going to write to, and when it finishes you can make it rewrite it's status file to something saying it's not writing<br /><br />I hope that's readable...</div></blockquote><br />Thank you it was readable :)<br />But I think sofar already answered this. :)</div>
		</div>

			<dl class="postprofile">
			<dt>
				<strong>Gundul</strong>
			</dt>
			<dd>Member</dd>

		<dd>&nbsp;</dd>

		<dd><strong>Posts:</strong> 416</dd><dd><strong>Joined:</strong> Thu Aug 27, 2015 10:55 am</dd>
			<dd><strong>GitHub:</strong> berengma</dd>
			
		</dl>
	
		<div class="back2top"><a href="#wrap" class="top" title="Top">Top</a></div>

		<span class="corners-bottom"><span></span></span></div>
	</div>

	<hr class="divider" />
	<div id="p340279" class="post bg2">
		<div class="inner"><span class="corners-top"><span></span></span>

		<div class="postbody">
			<h3 class=""><a href="https://sorcerykid.github.io/minetest-forums/pages/9_21725.htm#p340279">Re: [Mod] Exchange stuff between servers [Interkom]</a></h3>
			<p class="author"><img src="./styles/prosilver/imageset/icon_post_target.gif" width="11" height="9" alt="Post" title="Post" />by <strong>Gundul</strong> &raquo; Mon Jan 07, 2019 11:36 am </p>

			<div class="content"><blockquote><div><cite>sofar wrote:</cite>My initial thoughts on this mod are to secure the wire protocol and not use files as they are obviously prone to locking issues (as lua does none) and 2 servers could write the same file at the same time. A better implementation would be to use sockets to do all the communication, where each server has a &quot;receive&quot; socket, and the sender transmits by sending some json encoded structural content.<br /><br />The chatcommands and parsing of input are difficult things to get right (does it handle utf8 properly?) so I would think about replacing the chatcommands with a properly secured formspec where players need to put the actual items in a send slot, which also takes the trouble of knowing the item names away for players. You could use the sockets to send player lists to each server so that players know who is online or not and have the form display this, or maintain a friend list or something like that.</div></blockquote><br />You are right with the formspecs. I chose the chatcommands because experience from my servers says<br />players are lazy in writing. That way I could test my mod online on my servers more relaxed in the beginning.<br /><br />I must confess I have very little knowledge about sockets, but that can change. Always happy to learn something.<br />A quick search returned a &quot;lua socket api&quot; for lua 5.1. No idea if that could help. If someone knows any good source<br />or book please feel free to post/tell me.<br /><br />The next steps for interkom will be:<br /><ul>- use minetest.safe_write_file if possible<br />- restrict use of chatcommands to players with interkom(server ?) priv<br />- add formspecs to handle items and send them to connected servers<br />- find a way to use sockets </ul><br />These steps do not have to be static. I am happy for any serious idea someone could have.</div>
		</div>

			<dl class="postprofile">
			<dt>
				<strong>Gundul</strong>
			</dt>
			<dd>Member</dd>

		<dd>&nbsp;</dd>

		<dd><strong>Posts:</strong> 416</dd><dd><strong>Joined:</strong> Thu Aug 27, 2015 10:55 am</dd>
			<dd><strong>GitHub:</strong> berengma</dd>
			
		</dl>
	
		<div class="back2top"><a href="#wrap" class="top" title="Top">Top</a></div>

		<span class="corners-bottom"><span></span></span></div>
	</div>

	<hr class="divider" />
	<div id="p340581" class="post bg1">
		<div class="inner"><span class="corners-top"><span></span></span>

		<div class="postbody">
			<h3 class=""><a href="https://sorcerykid.github.io/minetest-forums/pages/9_21725.htm#p340581">save file writing</a></h3>
			<p class="author"><img src="./styles/prosilver/imageset/icon_post_target.gif" width="11" height="9" alt="Post" title="Post" />by <strong>Gundul</strong> &raquo; Thu Jan 10, 2019 11:59 am </p>

			<div class="content">created a new branch using minetest.safe_file_write<br /><a href="https://github.com/berengma/interkom/tree/savewrite" class="postlink">https://github.com/berengma/interkom/tree/savewrite</a></div>
		</div>

			<dl class="postprofile">
			<dt>
				<strong>Gundul</strong>
			</dt>
			<dd>Member</dd>

		<dd>&nbsp;</dd>

		<dd><strong>Posts:</strong> 416</dd><dd><strong>Joined:</strong> Thu Aug 27, 2015 10:55 am</dd>
			<dd><strong>GitHub:</strong> berengma</dd>
			
		</dl>
	
		<div class="back2top"><a href="#wrap" class="top" title="Top">Top</a></div>

		<span class="corners-bottom"><span></span></span></div>
	</div>

	<hr class="divider" />
	<div id="p344202" class="post bg2">
		<div class="inner"><span class="corners-top"><span></span></span>

		<div class="postbody">
			<h3 class=""><a href="https://sorcerykid.github.io/minetest-forums/pages/9_21725.htm#p344202">GUI and save_write_file</a></h3>
			<p class="author"><img src="./styles/prosilver/imageset/icon_post_target.gif" width="11" height="9" alt="Post" title="Post" />by <strong>Gundul</strong> &raquo; Sat Feb 23, 2019 7:45 am </p>

			<div class="content">Finished the gui. No more writing needed. Just type /stuff. On the left see the connected servers and on the right<br />you can see the players on that sever. To the four slots in the middle you can move the stuff you want to send.<br />Press send and watch chat messages if everything went well.<br /><br /><br />Now we have pictures :) <br /><img src="https://i.imgur.com/Qb1Oki7.png" alt="Image" /><br /><br />I will add support for unified_inventory shortly, so you can use directly from your inv.</div>
		</div>

			<dl class="postprofile">
			<dt>
				<strong>Gundul</strong>
			</dt>
			<dd>Member</dd>

		<dd>&nbsp;</dd>

		<dd><strong>Posts:</strong> 416</dd><dd><strong>Joined:</strong> Thu Aug 27, 2015 10:55 am</dd>
			<dd><strong>GitHub:</strong> berengma</dd>
			
		</dl>
	
		<div class="back2top"><a href="#wrap" class="top" title="Top">Top</a></div>

		<span class="corners-bottom"><span></span></span></div>
	</div>

	<hr class="divider" />
	<div id="p344519" class="post bg1">
		<div class="inner"><span class="corners-top"><span></span></span>

		<div class="postbody">
			<h3 class=""><a href="https://sorcerykid.github.io/minetest-forums/pages/9_21725.htm#p344519">Re: [Mod] Exchange stuff between servers [Interkom]</a></h3>
			<p class="author"><img src="./styles/prosilver/imageset/icon_post_target.gif" width="11" height="9" alt="Post" title="Post" />by <strong>Otter</strong> &raquo; Wed Feb 27, 2019 5:12 am </p>

			<div class="content">I just want to support that this is quite tested and seems to work without hitch. I am quite particular about things disappearing  in mods. The exchange using this software ends up being quite robust and when there were issues, the items did not get sent.<br />I have sent quite a bit of stuff between the servers. The stacks can be large on these servers so a lot can be sent at once. Between the servers there is a strong advantage to exchanges. Some things common enough on one are quite rare on the other. This worked out well.<br /><br />It was an entirely different mod and not one made by Gundul that showed a bug and deleted weeks of productivity. In retrospect, sending your most valuable resources from multiple servers to a single server is probably foolish. Loosing large stacks of diamond, and mese blocks that you spent weeks accumulating can be pretty discouraging. Especially when you need them to continue researching how to use the mod that destroyed the stuff. :)</div>
		</div>

			<dl class="postprofile">
			<dt>
				<strong>Otter</strong>
			</dt>
			<dd>Member</dd>

		<dd>&nbsp;</dd>

		<dd><strong>Posts:</strong> 146</dd><dd><strong>Joined:</strong> Fri May 12, 2017 9:17 pm</dd>
			
			
		</dl>
	
		<div class="back2top"><a href="#wrap" class="top" title="Top">Top</a></div>

		<span class="corners-bottom"><span></span></span></div>
	</div>

	<hr class="divider" />
	<div id="p344652" class="post bg2">
		<div class="inner"><span class="corners-top"><span></span></span>

		<div class="postbody">
			<h3 class=""><a href="https://sorcerykid.github.io/minetest-forums/pages/9_21725.htm#p344652">Re: [Mod] Exchange stuff between servers [Interkom]</a></h3>
			<p class="author"><img src="./styles/prosilver/imageset/icon_post_target.gif" width="11" height="9" alt="Post" title="Post" />by <strong>Gundul</strong> &raquo; Thu Feb 28, 2019 7:48 pm </p>

			<div class="content"><blockquote><div><cite>Otter wrote:</cite>I just want to support that this is quite tested and seems to work without hitch. I am quite particular about things disappearing  in mods. The exchange using this software ends up being quite robust and when there were issues, the items did not get sent.<br />I have sent quite a bit of stuff between the servers. The stacks can be large on these servers so a lot can be sent at once. Between the servers there is a strong advantage to exchanges. Some things common enough on one are quite rare on the other. This worked out well.<br /></div></blockquote><br />I can confirm, no issues so far since half a year running this on my servers. No lost stuff at all.<br />Now even everything can be sent, not only default:xxx and<br />with the new gui pretty easy for everyone to handle.<br /><br /><blockquote><div><cite>Otter wrote:</cite>It was an entirely different mod and not one made by Gundul that showed a bug and deleted weeks of productivity. In retrospect, sending your most valuable resources from multiple servers to a single server is probably foolish. Loosing large stacks of diamond, and mese blocks that you spent weeks accumulating can be pretty discouraging. Especially when you need them to continue researching how to use the mod that destroyed the stuff. :)</div></blockquote><br />Maybe interesting to know which mod that was ? I did not know that there was a mod like mine before.</div>
		</div>

			<dl class="postprofile">
			<dt>
				<strong>Gundul</strong>
			</dt>
			<dd>Member</dd>

		<dd>&nbsp;</dd>

		<dd><strong>Posts:</strong> 416</dd><dd><strong>Joined:</strong> Thu Aug 27, 2015 10:55 am</dd>
			<dd><strong>GitHub:</strong> berengma</dd>
			
		</dl>
	
		<div class="back2top"><a href="#wrap" class="top" title="Top">Top</a></div>

		<span class="corners-bottom"><span></span></span></div>
	</div>

	<hr class="divider" />
	<div id="p346112" class="post bg1">
		<div class="inner"><span class="corners-top"><span></span></span>

		<div class="postbody">
			<h3 class=""><a href="https://sorcerykid.github.io/minetest-forums/pages/9_21725.htm#p346112">Bugfix</a></h3>
			<p class="author"><img src="./styles/prosilver/imageset/icon_post_target.gif" width="11" height="9" alt="Post" title="Post" />by <strong>Gundul</strong> &raquo; Thu Mar 14, 2019 6:56 pm </p>

			<div class="content">Fixed bug today when sending with gui to new players.<br />You will be asked to whitelist the sender and if you /ok<br />all items will be added to your inv. No more losses !<br /><br /><br />Gundul</div>
		</div>

			<dl class="postprofile">
			<dt>
				<strong>Gundul</strong>
			</dt>
			<dd>Member</dd>

		<dd>&nbsp;</dd>

		<dd><strong>Posts:</strong> 416</dd><dd><strong>Joined:</strong> Thu Aug 27, 2015 10:55 am</dd>
			<dd><strong>GitHub:</strong> berengma</dd>
			
		</dl>
	
		<div class="back2top"><a href="#wrap" class="top" title="Top">Top</a></div>

		<span class="corners-bottom"><span></span></span></div>
	</div>

	<hr class="divider" />
	<div id="p346166" class="post bg2">
		<div class="inner"><span class="corners-top"><span></span></span>

		<div class="postbody">
			<h3 class=""><a href="https://sorcerykid.github.io/minetest-forums/pages/9_21725.htm#p346166">New button to unfied_inventory</a></h3>
			<p class="author"><img src="./styles/prosilver/imageset/icon_post_target.gif" width="11" height="9" alt="Post" title="Post" />by <strong>Gundul</strong> &raquo; Fri Mar 15, 2019 11:04 am </p>

			<div class="content">added button to unified_inventory for easy access :<br /><br /><img src="https://i.imgur.com/XXZiYf8.png" alt="Image" /></div>
		</div>

			<dl class="postprofile">
			<dt>
				<strong>Gundul</strong>
			</dt>
			<dd>Member</dd>

		<dd>&nbsp;</dd>

		<dd><strong>Posts:</strong> 416</dd><dd><strong>Joined:</strong> Thu Aug 27, 2015 10:55 am</dd>
			<dd><strong>GitHub:</strong> berengma</dd>
			
		</dl>
	
		<div class="back2top"><a href="#wrap" class="top" title="Top">Top</a></div>

		<span class="corners-bottom"><span></span></span></div>
	</div>

	<hr class="divider" />

	<hr class="divider" />

	<hr />

<div class="topic-actions">
		<div class="pagination">
			19 posts
			 &bull; Page <strong>1</strong> of <strong>1</strong>
		</div>
</div>

	<p></p><p><a href="./viewforum.php?f=9" class="left-box left" accesskey="r">Return to WIP Mods</a></p>

	<br /><br />

	<h3>Who is online</h3>
	<p>Users browsing this forum: <span style="color: #9E8DA7;" class="username-coloured">Bing Bot [Bot]</span> and 0 guests</p>
</div>

<div id="page-footer">

	<div class="navbar">
		<div class="inner"><span class="corners-top"><span></span></span>

		<ul class="linklist">
			<li class="icon-home"><a href="./index.php">Board index</a></li>
				
			<li class="rightside">All times are UTC </li>
		</ul>

		<span class="corners-bottom"><span></span></span></div>
	</div>

	<div class="copyright">Powered by <a href="https://www.phpbb.com/">phpBB</a>&reg; Forum Software &copy; phpBB Group
		
	</div>
</div>

</div>

<div>
	<a id="bottom" name="bottom" accesskey="z"></a>
	
</div>

</body>
</html></div>

